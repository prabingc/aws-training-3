pipeline {
    agent {
        kubernetes {
            label 'jenkins-agent'
            defaultContainer 'jnlp' // must match container name in pod template
        }
    }

    environment {
        AWS_REGION = 'us-east-2'
        CLUSTER_NAME = 'prabin-eks'
    }

    stages {
        stage('Deploy Pod to EKS') {
            steps {
                script {
                    def podManifest = """
                    apiVersion: v1
                    kind: Pod
                    metadata:
                      name: nginx-pod
                    spec:
                      containers:
                      - name: nginx
                        image: nginx:latest
                        ports:
                        - containerPort: 80
                    """

                    writeFile file: 'nginx-pod.yaml', text: podManifest
                    agent {label 'master'}
                    sh 'kubectl apply -f nginx-pod.yaml'
                }
            }
        }
    }
}