pipeline {
    agent any
    environment {
    jenkin_cred = credentials('jenkins_call') // Reference the credentials ID
    }
    stages {
        stage('Create new pipelines') {
            steps {
                sh '''
                    curl -O http://localhost:8080/jnlpJars/jenkins-cli.jar
                    java -jar jenkins-cli.jar -s http://localhost:8080  -auth ${jenkin_cred_usr}:${jenkin_cred_psw} create-job automation1 < eks_cluster.xml
                '''
            }
        }
        stage('Load Shared Vars') {
            steps {
                script {
                def vars = load 'vars/sharedVars.groovy'
                env.AWS_REGION = vars.AWS_REGION
                }
            }
            }  
        stage('Create EKS Cluster') {
                    steps {
                        script {
                            withAWS(credentials: 'aws-creds', region: env.AWS_REGION) {
                                sh 'eksctl create cluster -f cluster_definition.yaml'
                            }
                        }
                    }
                }
            }
    }